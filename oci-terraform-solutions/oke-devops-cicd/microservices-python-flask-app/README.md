# Microservices Python Flask App

Small sample microservice written with Flask used by the `oke-devops-cicd` pipelines. This folder includes the application code, Dockerfile, pipeline buildspec, Kubernetes manifests and helper scripts used in the repository's CI/CD examples.

Contents

- `app.py` — Minimal Flask web application.
- `requirements.txt` — Python dependencies.
- `Dockerfile` — Container image build instructions.
- `build_spec.yaml` — Buildspec used by DevOps/CI pipelines.
- `entrypoint.sh` — Container entrypoint script (used by the Dockerfile).
- `gitpush.sh` — Helper to push code and/or trigger pipeline (project-specific; inspect before running).
- `k8s-sample-yaml/` — Kubernetes manifests (deployment, service, secrets) for deploying the app into OKE.

Quickstart — run locally (no Docker)

1. Create a virtual environment and activate it:

```bash
python3 -m venv .venv
source .venv/bin/activate
```

2. Install dependencies:

```bash
pip install -r requirements.txt
```

3. Run the app:

```bash
python app.py
# Or: FLASK_APP=app.py flask run --host=0.0.0.0 --port=5000
```

4. Visit http://localhost:5000

Build and run with Docker

1. Build the image (example tag):

```bash
docker build -t microservices-python-flask-app:latest .
```

2. Run the container:

```bash
docker run --rm -p 5000:5000 microservices-python-flask-app:latest
# Visit http://localhost:5000
```

Kubernetes (deploy to a cluster)

1. Make sure you have a kubeconfig that points to your cluster and `kubectl` installed.
2. Edit `k8s-sample-yaml/app-secrets.yaml` to include any secrets (or use your secret manager).
3. Apply manifests:

```bash
kubectl apply -f k8s-sample-yaml/deployment.yaml
kubectl apply -f k8s-sample-yaml/service.yaml
# Optional: apply secrets
kubectl apply -f k8s-sample-yaml/app-secrets.yaml
```

4. Check rollout:

```bash
kubectl rollout status deployment/<deployment-name>
kubectl get svc
kubectl get pods -A
```

CI/CD notes

- The `build_spec.yaml` is the build specification used by the repository's DevOps/CI pipelines. It defines build steps, testing, and image push steps for the microservice. This is automatically generated by oke-devops-cicd workspace.
- `gitpush.sh` is a convenience script to push changes to the configured Git remote and may trigger automated pipelines depending on your DevOps setup. Inspect the script before running.
- For pipelines to push container images, ensure the build service has permissions to the target container registry and the repository references/credentials are configured correctly in the DevOps project.

Environment variables and configuration

- The app reads configuration from environment variables (check `app.py`). Typical variables:
  - PORT (default 5000)
  - Any other variables used by your app-specific logic.

Logs

- When running locally, logs are printed to stdout.
- When running in containers, use `docker logs <container>` or `kubectl logs <pod>` to view logs.

Troubleshooting

- Port already in use: change the port when running locally or stop the process using it.
- Container image not starting: check the container logs for errors; ensure `entrypoint.sh` is executable (Dockerfile should set the correct permissions).
- Kubernetes issues: check `kubectl describe pod <pod>` and `kubectl logs` for the failing pod.


